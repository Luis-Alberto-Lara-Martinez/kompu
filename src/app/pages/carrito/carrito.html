<app-menu></app-menu>
<app-scroll-to-top></app-scroll-to-top>

<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h4 class="fw-semibold">Carrito</h4>
    <span class="text-muted">{{ carrito.length }} productos</span>
  </div>

  @if (carrito.length === 0) {
  <div class="alert alert-info" role="alert">
    Tu carrito está vacío.
  </div>
  }@else {
  <div class="d-flex flex-column gap-3">
    @for (producto of carrito; track $index) {
    <div class="card shadow-sm">
      <div class="card-body d-flex align-items-center gap-3">
        <img class="w-25 h-25" [src]="producto.listaImagenes[0]" [alt]="producto.nombre">

        <div class="flex-grow-1">
          <div class="d-flex justify-content-between align-items-center">
            <h6>{{ producto.nombre }}</h6>
            <div class="fw-semibold">{{ transformarPrecio(producto.precio) }}</div>
          </div>

          <p class="text-secondary small">{{ producto.descripcion }}</p>

          <div class="d-flex align-items-center gap-2">
            <label class="small text-secondary me-2">Cantidad</label>
            <input type="number" class="form-control form-control-sm w-auto" min="1" [value]="producto.cantidad || 1"
              (input)="actualizarCantidad(producto, $event)">

            <button type="button" class="btn btn-outline-danger btn-sm ms-auto"
              (click)="eliminarDelCarrito(producto.id)">Eliminar</button>
          </div>
        </div>
      </div>
    </div>
    }
  </div>

  <!-- Resumen -->
  <div class="card mt-3">
    <div class="card-body d-flex flex-wrap justify-content-between align-items-center gap-3">
      <div class="d-flex flex-column">
        <div class="d-flex justify-content-between gap-4">
          <span class="text-body-secondary">Subtotal (sin IVA):</span>
          <span class="fw-semibold">{{ (precioTotal/1.21).toFixed(2) }}€</span>
        </div>
        <div class="d-flex justify-content-between gap-4">
          <span class="text-body-secondary">IVA (21%):</span>
          <span class="fw-semibold">{{ (precioTotal - (precioTotal/1.21)).toFixed(2) }}€</span>
        </div>
        <div class="d-flex justify-content-between gap-4 border-top pt-2 mt-2">
          <span class="fw-semibold">Total:</span>
          <span class="fw-bold">{{ precioTotal.toFixed(2) }}€</span>
        </div>
      </div>

      <div class="flex-grow-1 text-end">
        <app-paypal-button [totalCompra]="precioTotal"></app-paypal-button>
      </div>
    </div>
  </div>
  }
</div>
<app-pie-pagina></app-pie-pagina>